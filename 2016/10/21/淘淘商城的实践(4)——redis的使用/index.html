<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <title> 商城的实践(4)——redis的使用 · zgshen </title>
    <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="browsermode" content="application">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="zgshen">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="msapplication-navbutton-color" content="#666666">
<meta name= "format-detection" content="telephone=no" />
<meta name="keywords" content="nlvi, Nlvi" />


    <meta name="subtitle" content="欢迎…">


    <meta name="description" content="啊深的博客。记录一些日常琐事和技术心得等等。">


    <meta name="keywords" content="JavaSE,Spring,其他" />


    <meta name="keywords" content="商城技术应用, Nlvi" />

<link rel="stylesheet" href="/style/style.css">
<script src="/script/jquery.min.js"></script>
<script>
    var CONFIG = {
        title: "zgshen",
        author: "zgshen",
        lightbox: true,
        animate: true
    }
</script>



    <link rel="stylesheet" href="/lightbox/css/lightbox.min.css">




    <link rel="stylesheet" href="/syuanpi/syuanpi.min.css">







  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-106347761-1', 'auto');
  ga('send', 'pageview');
</script>


  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?7c5eafa8151dbb980bab283494b9a0e2";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>



</head>
<body>
    <div class="progress">
    <div class="progress-inner"></div>
</div>
    <div class="body">
    <div class="tagcloud-mask"></div>  
<div class="tagcloud" id="tagcloud">
    <div class="tagcloud-inner">
        <a href="/tags/Java基础/" style="font-size: 14px;">Java基础</a> <a href="/tags/Linux/" style="font-size: 14px;">Linux</a> <a href="/tags/Spring/" style="font-size: 14px;">Spring</a> <a href="/tags/Web技术/" style="font-size: 14px;">Web技术</a> <a href="/tags/spring/" style="font-size: 14px;">spring</a> <a href="/tags/web框架/" style="font-size: 14px;">web框架</a> <a href="/tags/其他/" style="font-size: 14px;">其他</a> <a href="/tags/博客/" style="font-size: 14px;">博客</a> <a href="/tags/商城技术应用/" style="font-size: 14px;">商城技术应用</a> <a href="/tags/数据库/" style="font-size: 14px;">数据库</a>
    </div>
</div>
    <header class="header" id="header">
    <div class="title syuanpi tvIn">
    <div class="table">
        <div class="connect">
            <div class="connect-inner">
                <span><a href="/">zgshen</a></span>
                
                    <span id="subtitle">欢迎…</span>
                
            </div>
        </div>
    </div>
</div>
    <nav class="main-nav syuanpi tvIn">
<div class="table">

    <ul class="menu">
        
        <li class="menu-item">
            <a href="javascript:;" id="search">
                <span>搜索</span>
                
                    <span class="menu-item-label">search</span>
                
            </a>
        </li>
        
        
        
            <li class="menu-item">
                <a href="/">
                    <span>文章</span>
                    
                        <span class="menu-item-label">article</span>
                    
                </a>
            </li>
        
        
        
            <li class="menu-item">
                <a href="/archives">
                    <span>归档</span>
                    
                        <span class="menu-item-label">archives</span>
                    
                </a>
            </li>
        
        
        
            <li class="menu-item">
                <a href="javascript:;" id="tags">
                    <span>标签</span>
                    
                        <span class="menu-item-label">tags</span>
                    
                </a>
            </li>
        
        
        
            <li class="menu-item">
                <a href="/about">
                    <span>关于</span>
                    
                        <span class="menu-item-label">about</span>
                    
                </a>
            </li>
        
        
        
            <li class="menu-item">
                <a href="/atom.xml">
                    <span>订阅</span>
                    
                        <span class="menu-item-label">RSS</span>
                    
                </a>
            </li>
        
        
    </ul>

</div>
</nav>
</header>
<div class="mobile-header">
    <div class="mobile-header-body">
        <div class="mobile-header-list">
            
            
                <div class="mobile-nav-item">
                    <a href="/">
                        <span>文章</span>
                        
                            <span class="menu-item-label">article</span>
                        
                    </a>
                </div>
            
            
            
                <div class="mobile-nav-item">
                    <a href="/archives">
                        <span>归档</span>
                        
                            <span class="menu-item-label">archives</span>
                        
                    </a>
                </div>
            
            
            
                <div class="mobile-nav-item inner-cloud">
                    <div class="mobile-nav-tag">
                        <a href="javascript:;" id="mobile-tags">
                            <span>标签</span>
                            
                                <span class="menu-item-label">tags</span>
                            
                        </a>
                    </div>
                    <div class="mobile-nav-tagcloud">
                        <div class="mobile-tagcloud-inner">
                            <a href="/tags/Java基础/" style="font-size: 14px;">Java基础</a> <a href="/tags/Linux/" style="font-size: 14px;">Linux</a> <a href="/tags/Spring/" style="font-size: 14px;">Spring</a> <a href="/tags/Web技术/" style="font-size: 14px;">Web技术</a> <a href="/tags/spring/" style="font-size: 14px;">spring</a> <a href="/tags/web框架/" style="font-size: 14px;">web框架</a> <a href="/tags/其他/" style="font-size: 14px;">其他</a> <a href="/tags/博客/" style="font-size: 14px;">博客</a> <a href="/tags/商城技术应用/" style="font-size: 14px;">商城技术应用</a> <a href="/tags/数据库/" style="font-size: 14px;">数据库</a>
                        </div>
                    </div>
                </div>
            
            
            
                <div class="mobile-nav-item">
                    <a href="/about">
                        <span>关于</span>
                        
                            <span class="menu-item-label">about</span>
                        
                    </a>
                </div>
            
            
            
                <div class="mobile-nav-item">
                    <a href="/atom.xml">
                        <span>订阅</span>
                        
                            <span class="menu-item-label">RSS</span>
                        
                    </a>
                </div>
            
            
        </div>
    </div>
    <div class="mobile-header-nav">
        <div class="mobile-header-item" id="mobile-left">
            <div class="header-menu-item">
                <span class="header-menu-line"></span>
            </div>
        </div>
        <h1 class="mobile-header-title">
            <a href="/">zgshen</a>
        </h1>
        <div class="mobile-header-item"></div>
    </div>
</div>

    <div class="container">
        <main class="main" id="main">
            
    
    <article class="post">
        <header class="post-header">
            <div class="post-time syuanpi riseIn-light back-1">
                <span>2016年10月21日</span>
                
            </div>
            <h1 class="post-title syuanpi riseIn-light back-2">
            
                商城的实践(4)——redis的使用
            
            </h1>
            
                
                    <div class="post-tags syuanpi riseIn-light back-3">
                    
                        <a href="/tags/商城技术应用/">商城技术应用</a>
                    
                    </div>
                
            
        </header>
        <div class="post-content syuanpi riseIn-light back-3">
            
                <blockquote>
<p>一忙起来就不动博客了，这样不好，接着上个月的商城小项目。上次商城系统从后台发布商品到前台工程的展示都已经实现了，但实际上线系统由于用户数量增多，为了应付网站的大访问量，降低数据库及整个系统的压力，一般都会选择缓存功能。</p>
</blockquote>
<h4 id="一、缓存工具的选择——redis"><a href="#一、缓存工具的选择——redis" class="headerlink" title="一、缓存工具的选择——redis"></a>一、缓存工具的选择——redis</h4><blockquote>
<p>Redis是一个开源的使用ANSI C语言编写、支持网络、可基于内存亦可持久化的日志型、Key-Value数据库，并提供多种语言的API。<br><a id="more"></a></p>
<h5 id="1、安装启动"><a href="#1、安装启动" class="headerlink" title="1、安装启动"></a>1、安装启动</h5><p>先到<a href="http://redis.io/download" target="_blank">官网</a>下载需要的对应版本的redis。redis是用C语言写的，下载有编译版和直接安装的。<br>我这里直接用win版，解压，cd到根目录，执行redis-server.exe就可以启动redis了，默认端口6379:<br><img src="http://img.blog.csdn.net/20161125005932896" width="98%"><br>再新开dos，cd到redis根目录，redis-cli打开客户端，输入ping测试，响应返回pong，表示客户服务两端连接正常：<br><img src="http://img.blog.csdn.net/20161125010853204" alt="这里写图片描述"><br>然后就可以愉快进行操作了。之前公司有简单用到redis，试着放在win下，然后，貌似不怎么稳定，这东西还是放Linux下吧。</p>
<h5 id="2、可视化工具"><a href="#2、可视化工具" class="headerlink" title="2、可视化工具"></a>2、可视化工具</h5><p>在Windows下redis提供了一个可视化工具，可以链接和查看redis的各种信息。<a href="http://download.csdn.net/detail/u012809062/9499207" target="_blank">[RedisDesktopManager]</a></p>
</blockquote>
<h4 id="二、redis和spring的整合"><a href="#二、redis和spring的整合" class="headerlink" title="二、redis和spring的整合"></a>二、redis和spring的整合</h4><p>这里只看单机版的。根据系统的架构，所有与redis的数据交互都在taotao-rest工程完成，在本工程的操作直接注入调用redis相应的实现类即可，对于其他工程则需提供另外接口服务以供调用。</p>
<h5 id="1、xml的配置"><a href="#1、xml的配置" class="headerlink" title="1、xml的配置"></a>1、xml的配置</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">&lt;!-- 连接池配置 --&gt;</div><div class="line">	&lt;bean id=&quot;jedisPoolConfig&quot; class=&quot;redis.clients.jedis.JedisPoolConfig&quot;&gt;</div><div class="line">		&lt;!-- 最大连接数 --&gt;</div><div class="line">		&lt;property name=&quot;maxTotal&quot; value=&quot;30&quot; /&gt;</div><div class="line">		&lt;!-- 最大空闲连接数 --&gt;</div><div class="line">		&lt;property name=&quot;maxIdle&quot; value=&quot;10&quot; /&gt;</div><div class="line">		&lt;!-- 每次释放连接的最大数目 --&gt;</div><div class="line">		&lt;property name=&quot;numTestsPerEvictionRun&quot; value=&quot;1024&quot; /&gt;</div><div class="line">		&lt;!-- 释放连接的扫描间隔（毫秒） --&gt;</div><div class="line">		&lt;property name=&quot;timeBetweenEvictionRunsMillis&quot; value=&quot;30000&quot; /&gt;</div><div class="line">		&lt;!-- 连接最小空闲时间 --&gt;</div><div class="line">		&lt;property name=&quot;minEvictableIdleTimeMillis&quot; value=&quot;1800000&quot; /&gt;</div><div class="line">		&lt;!-- 连接空闲多久后释放, 当空闲时间&gt;该值 且 空闲连接&gt;最大空闲连接数 时直接释放 --&gt;</div><div class="line">		&lt;property name=&quot;softMinEvictableIdleTimeMillis&quot; value=&quot;10000&quot; /&gt;</div><div class="line">		&lt;!-- 获取连接时的最大等待毫秒数,小于零:阻塞不确定的时间,默认-1 --&gt;</div><div class="line">		&lt;property name=&quot;maxWaitMillis&quot; value=&quot;1500&quot; /&gt;</div><div class="line">		&lt;!-- 在获取连接的时候检查有效性, 默认false --&gt;</div><div class="line">		&lt;property name=&quot;testOnBorrow&quot; value=&quot;true&quot; /&gt;</div><div class="line">		&lt;!-- 在空闲时检查有效性, 默认false --&gt;</div><div class="line">		&lt;property name=&quot;testWhileIdle&quot; value=&quot;true&quot; /&gt;</div><div class="line">		&lt;!-- 连接耗尽时是否阻塞, false报异常,ture阻塞直到超时, 默认true --&gt;</div><div class="line">		&lt;property name=&quot;blockWhenExhausted&quot; value=&quot;false&quot; /&gt;</div><div class="line">	&lt;/bean&gt;</div><div class="line">	</div><div class="line">	&lt;!-- redis连接池 --&gt;</div><div class="line">	&lt;bean id=&quot;redisClient&quot; class=&quot;redis.clients.jedis.JedisPool&quot;&gt;</div><div class="line">		&lt;constructor-arg name=&quot;host&quot; value=&quot;127.0.0.1&quot;&gt;&lt;/constructor-arg&gt;</div><div class="line">		&lt;constructor-arg name=&quot;port&quot; value=&quot;6379&quot;&gt;&lt;/constructor-arg&gt;</div><div class="line">		&lt;constructor-arg name=&quot;poolConfig&quot; ref=&quot;jedisPoolConfig&quot;&gt;&lt;/constructor-arg&gt;</div><div class="line">	&lt;/bean&gt;</div><div class="line">	&lt;bean id=&quot;jedisClient&quot; class=&quot;com.taotao.rest.dao.impl.JedisClientSingle&quot;&gt;&lt;/bean&gt;</div></pre></td></tr></table></figure>
<h5 id="2、接口及实现"><a href="#2、接口及实现" class="headerlink" title="2、接口及实现"></a>2、接口及实现</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">package com.taotao.rest.dao;</div><div class="line">public interface JedisClient &#123;</div><div class="line">	String get(String key);</div><div class="line">	String set(String key, String value);</div><div class="line">	String hget(String hkey, String key);</div><div class="line">	long hset(String hkey, String key, String value);//hash</div><div class="line">	long incr(String key);//自增</div><div class="line">	long expire(String key, int second);//设置过期时间,单位秒</div><div class="line">	long ttl(String key);//生存时间</div><div class="line">	long del(String key);//删除</div><div class="line">	long hdel(String hkey, String key);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>JedisClientSingle再实现JedisClient 接口，完成redis的基本功能。<br>系统的缓存逻辑是从redis获取数据，若redis对应数据不存在，就从mysql数据库取数据存储到redis中，返回。下次即能直接从redis获得数据，若数据发生变更，在变更操作后删除对应键值在redis中的数据，重复上述方法。</p>
<h5 id="3、为其他工程提供服务接口"><a href="#3、为其他工程提供服务接口" class="headerlink" title="3、为其他工程提供服务接口"></a>3、为其他工程提供服务接口</h5><p>以taotao-manager-service内容管理更新redis为例。dao接口仍然是JedisClient ,基础操作功能一样。<br>实现类为一个Service。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">@Service</div><div class="line">public class RedisServiceImpl implements RedisService </div><div class="line">	@Autowired</div><div class="line">	private JedisClient jedisClient;</div><div class="line">	@Value(&quot;$&#123;INDEX_CONTENT_REDIS_KEY&#125;&quot;)</div><div class="line">	private String INDEX_CONTENT_REDIS_KEY;</div><div class="line">	@Override</div><div class="line">	public TaotaoResult syncContent(long contentCid) &#123;</div><div class="line">		try &#123;</div><div class="line">			jedisClient.hdel(INDEX_CONTENT_REDIS_KEY, contentCid + &quot;&quot;);</div><div class="line">		&#125; catch (Exception e) &#123;</div><div class="line">			e.printStackTrace();</div><div class="line">			return TaotaoResult.build(500, ExceptionUtil.getStackTrace(e));</div><div class="line">		&#125;</div><div class="line">		return TaotaoResult.ok();</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>controller发布service,需要时直接根据http调此controller即可。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">@Controller</div><div class="line">@RequestMapping(&quot;/cache/sync&quot;)</div><div class="line">public class RedisController &#123;</div><div class="line">	@Autowired</div><div class="line">	private RedisService redisService;</div><div class="line">	@RequestMapping(&quot;/content/&#123;contentCid&#125;&quot;)</div><div class="line">	@ResponseBody</div><div class="line">	public TaotaoResult contentCacheSync(@PathVariable Long contentCid) &#123;</div><div class="line">		TaotaoResult result = redisService.syncContent(contentCid);</div><div class="line">		return result;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="redis看似上手简单，但真正要应用起来就不是这么回事了，需要用到redis应该都死初具规模或有特殊要求的系统，要用好不容易。作为一个广泛使用的nosql数据库，值得去学习了解。"><a href="#redis看似上手简单，但真正要应用起来就不是这么回事了，需要用到redis应该都死初具规模或有特殊要求的系统，要用好不容易。作为一个广泛使用的nosql数据库，值得去学习了解。" class="headerlink" title="redis看似上手简单，但真正要应用起来就不是这么回事了，需要用到redis应该都死初具规模或有特殊要求的系统，要用好不容易。作为一个广泛使用的nosql数据库，值得去学习了解。"></a>redis看似上手简单，但真正要应用起来就不是这么回事了，需要用到redis应该都死初具规模或有特殊要求的系统，要用好不容易。作为一个广泛使用的nosql数据库，值得去学习了解。</h4><h4 id="商城剩下比较主要的内容包括全文检索、单点登录、nginx及系统架构分析，只是作为一个培训练习的项目也没太多可以看了。"><a href="#商城剩下比较主要的内容包括全文检索、单点登录、nginx及系统架构分析，只是作为一个培训练习的项目也没太多可以看了。" class="headerlink" title="商城剩下比较主要的内容包括全文检索、单点登录、nginx及系统架构分析，只是作为一个培训练习的项目也没太多可以看了。"></a>商城剩下比较主要的内容包括全文检索、单点登录、nginx及系统架构分析，只是作为一个培训练习的项目也没太多可以看了。</h4>
            
        
        </div>
        
            
            
        
    </article>
    
        
    <nav class="article-page">
        
            <a href="/2016/11/28/solr全文检索/" id="art-left" class="art-left">
                <span class="next-title">
                    <i class="iconfont icon-left"></i>商城的实践(5)——Solr全文检索
                </span>
            </a>
        
        
            <a href="/2016/10/02/淘淘商城的实践(3)——图片服务器部署和前台工程/" id="art-right" class="art-right">
                <span class="prev-title"> 
                    商城的实践(3)——图片服务器部署和前台工程<i class="iconfont icon-right"></i>
                </span>
            </a>
        
    </nav>

        
    


        </main>
        <footer class="footer syuanpi fadeIn" id="footer">
    <hr>
    <div class="footer-wrapper">
        <div class="left">
            <div class="contact-icon">
    
    
    
    
    
    
    
    
        
            <a href="https://github.com/zgshen" class="iconfont icon-github" title="github"></a>
        
        
        
        
        
        
        
    
</div>
        </div>
        <div class="right">
            <div class="copyright">
    <div class="info">
        <span>&copy;</span>
        <span>2016 ~ 2017</span>
        <span></span>
        <span>zgshen</span>
    </div>
    <div class="theme">
        <span>
            Powered by
            <a href="http://hexo.io/" target="_blank">Hexo </a>
        </span>
        <span>
            Theme
            <a href="https://github.com/ColMugX/hexo-theme-Nlvi"> Nlvi </a>
        </span>
    </div>
    
</div>
        </div>
    </div>
</footer>
    </div>
    <script src="/script/nlvi.js"></script>
<script src="/script/search.js"></script>

    <script src="/lightbox/js/lightbox.min.js"></script>

<script>
$(document).ready(function(){
    document.body.addEventListener('touchstart', function () {});
    $('.progress').hide();
    $('.body').show();
    Nlvi.tagcloud();
    Nlvi.mobileHeader();
    Nlvi.back2top();
    Nlvi.smoothScroll();
    Nlvi.onView();
    Nlvi.showToc();
    Nlvi.showComments();
    Nlvi.showReward();

    !CONFIG.animate && Nlvi.offAnimate();
    CONFIG.lightbox && Nlvi.onPicBox();
})
</script>
    </div>
    
        
    
    <div class="backtop syuanpi dead toTop" id="backtop">
    <i class="iconfont icon-up"></i>
    <span style="text-align:center;font-family:Georgia;"><span style="font-family:Georgia;" id="scrollpercent">1</span>%</span>
</div>
    
    <div class="search" id="search">
        <div class="mask" id="mask"></div>
        <div class="search-wrapper syuanpi">
            <h1 id="search-header" class="syuanpi">搜索一下？</h1>
            <div class="input">
                <input type="text" id="local-search-input" results="0" name="">
            </div>
            <div id="local-search-result"></div>
        </div>
    </div>
    <script>
    var GREETING = {
        morning: "当我们探索时，就要发现到真理",
        noon: "人的天职在于勇于探索真理。",
        after: "一件事实是一条没有性别的真理",
        night: "真理有时可能变得黯淡，但它永远不会熄灭",
        midnight: "真理在人那里获得生命力，并且展现出来"
    }
    $(document).ready(function(){
        Nlvi.search();
    });
    </script>

</body>
</html>
