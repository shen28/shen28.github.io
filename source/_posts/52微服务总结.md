---
title: 微服务要点梳理
categories: 技术
tags: 面试
date: 2020-12-22
---

微服务是一种用于构建应用的架构方案。微服务架构有别于更为传统的单体式方案，可将应用拆分成多个核心功能。每个功能都被称为一项服务，可以单独构建和部署，这意味着各项服务在工作（和出现故障）时不会相互影响。
<!-- more -->
**好处**
- 针对特定服务发布，影响小，风险小，成本低
- 频繁发布版本，快速交付需求
- 低成本扩容，弹性伸缩，适应云环境

**问题**
- 分布式系统的复杂性
- 部署，测试和监控的成本问题
- 分布式事务和CAP的相关问题

**CAP理论**
- Consistency 一致性：写之后的操作，必须返回该值。分布式系统中任意一个节点都会查询到相同的信息。
- Availability 可用性：正常响应时间，服务一直可用。只要收到用户请求，服务器就必须做出响应。
- Partition tolerance 分区容错性：区之间通讯可能失败，容忍某些区奔溃。当部分节点出现问题的时候，系统依然能正常堆外提供服务。

## Spring Cloud 组件

- 注册中心 Eureka，其他的还有 Zookeeper、Consul 和 Nacos。用于服务发现；
- 配置中心 Spring Cloud Config
- 网关 Spring Gateway 和 Zuul
- 客户端负载均衡 Ribbon，默认策略是轮询
- 断路器 Hystix
- RPC 客户端 Feign

**限流方法**
- 计数器（固定窗口）
- 令牌桶
- 漏桶
- 滑动窗口

**负载均衡方法**
- 随机
- 轮询
- 加权轮询

**分布式锁**
- 数据库级别：读频繁用客观锁，写频繁用悲观锁
    - 乐观锁：基于版本号实现
    - 悲观锁：基于数据库级别的 for update
- 基于 Redis 原子性操作，使用 setnx 和 expire 实现
- 基于 Rdisson 框架实现
- 基于 Zookeeper，使用 InterprocessMutex 实现

**分布式事务**
- 基于 XA 协议的 2PC （两阶段提交）和 3PC
- 基于业务层的 TCC 方案
- 使用应用消息队列 + 本地消息表实现的最终一致性方案
- 最大努力通知

